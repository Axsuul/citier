---
title: User Guide
layout: wikistyle
---

CITIER User Guide
=========================

We give here the details to use our solution. Note that a functional web app implementing the multimedia library example is available here. It may be worth having a look at it since each specific code entry necessitated by the use of our plugin has been associated with a “#needed for CITIER" comment. Moreover some extra Comments & BookComments objects have been added to exhibit that Callbacks functionalities are also available (in fact every ActiveRecord facility should be available). Installing this app and getting into code may be a good way to understand how to use our gem.

You should follow the next steps to use CITIER:

1. Model your class inheritance hierarchy [Our Example](problem.html)
2. Once your class inheritance hierarchy is modeled : determine what we will call the *role* of each class. There are 3 kind of *roles*:
	- **"root class"** : the “root class" is the class which will inherit from ActiveRecord::Base and from which all of your modeled classes derive. In our example Media is the “root class".
	- **"class with specific attribute(s)"** : this stands for classes that do have specific attributes (attributes that are not included in the classes they derive from). In our example Audio, Video, Book, Novel, Dictionary are "classes with specific attribute(s)".
	- **"class without specific attribute(s)"** : this stands for classes that do NOT have specific attributes. In our example Mp3, PocketDictionary, Unknown are "classes without specific attribute(s)".
3. Once roles are determined : determine the database schema (it is better if this schema is such that it avoids duplication (see for instance [our example](new_solution.html)). Note that the table associated to the root class requires one extra columns that we will call inheritance_column (our solution uses notably Rails Single Table Inheritance facility). (To sum up : the “root class" necessitates a table with columns : id, inheritance_column and a column per attribute ; each "class with specific attribute(s)" necessitates a table with columns : id and a column per specific attribute)
For our example, this mean that we need 6 tables :
	- Table medias with columns id, inheritance_column, price and name
	- Table audio with columns id, title and genre
	- Table videos with columns id, title and genre
	- Table tablebooks with columns id, title and author
	- Table novels with columns id and summary
	- Table dictionaries with columns id, language1, and language2
4. 	Determine views that are needed (one per ”class with specific attribute(s)”) (see for instance our example) . Such views may be created thanks to the provided function CreateTheViewForCITIEs(class) or dropped with the provided function DropTheViewForCITIEs(class).
For our example, this mean that we need 5 views :
	- View view_audios (which may be generated by CreateTheViewForCITIEs(Audio))
	- View view_videos (which may be generated by CreateTheViewForCITIEs(Video))
	- View view_tablebooks (which may be generated by CreateTheViewForCITIEs(Book))
	- View view_novels (which may be generated by CreateTheViewForCITIEs(Novel))
	- View view_dictionaries (which may be Generated by CreateTheViewForCITIEs(Dictionary))
5.	Write the migrations needed for establishing the database schema (tables & views) For our example this would mean generating the following migrations:
	
	{% highlight ruby %}
	
	class CreateMedias < ActiveRecord::Migration
	  def self.up
	    create_table :medias do |t|
	      t.string :inheritance_column_name
	      t.string :name
	      t.integer :price
	    end
	  end
	  def self.down
	    drop_table :medias
	  end
	end
	
	################################################
	
	class CreateBooks < ActiveRecord::Migration
	  def self.up
	    create_table :tablebooks do |t|
	      t.string :title
	      t.string :author
	    end
	    CreateTheViewForCITIEs(Book)
	  end
	  def self.down
	    DropTheViewForCITIEs(Book)
	    drop_table :books
	  end
	end
	
	################################################
	
	class CreateDictionaries < ActiveRecord::Migration
	  def self.up
	    create_table :dictionaries do |t|
	      t.string :lf
	      t.string :lt
	    end
	    CreateTheViewForCITIEs(Dictionary)
	  end
	  def self.down
	    DropTheViewForCITIEs(Dictionary)
	    drop_table :dictionaries
	  end
	end
	
	################################################
	
	class CreateNovels < ActiveRecord::Migration
	  def self.up
	    create_table :novels do |t|
	      t.string :summary
	    end
	    CreateTheViewForCITIEs(Novel)
	  end
	  def self.down
	    DropTheViewForCITIEs(Novel)
	    drop_table :novels
	  end
	end
	
	################################################
	
	class CreateVideos < ActiveRecord::Migration
	  def self.up
	    create_table :videos do |t|
	      t.string :title
	      t.string :genre
	    end
	    CreateTheViewForCITIEs(Video)
	  end
	  def self.down
	    DropTheViewForCITIEs(Video)
	    drop_table :videos
	  end
	end
	
	################################################
	
	class CreateAudios < ActiveRecord::Migration
	  def self.up
	    create_table :audios do |t|
	      t.string :title
	      t.string :genre
	    end
	    CreateTheViewForCITIEs(Audio)
	  end
	  def self.down
	    DropTheViewForCITIEs(Audio)
	    drop_table :audios
	  end
	end
	
	{% endhighlight %}

6. 	Now you have to indicate for each classes its role. This is done into your models definitions by adding the special phrase : “acts\_as\_citier” only for the root\_class and for each ”class with specific attribute(s)”. This special phrase may be accompanied by an optional option hash : {:table\_name=>'name\_of\_the\_table\_associated\_with\_the\_class' , :db\_type\_field=>'name_of_the_inheritance_column'}. Note that default values for these options are respectively the pluralized name of the class for :table\_name and 'type' for :db\_type\_field. For our example this would imply the following:
	
	{% highlight ruby %}
	
	# Default values are used there since the table associated to Media class is medias 
	# and the inheritance column is named type in the following models definitions we 
	# won't mention that the default value is used for :db_\type\_field and will only 
	# mention non default value for :table name when needed
		
	class Media < ActiveRecord::Base
	  acts_as_citier 
	end
	
	################################################
	
	class Audio < Media
	  acts_as_citier
	end
	
	################################################
	
	class Mp3 < Audio
	end
	
	################################################
	
	# Here we need to specify :table_name=>'books' since the table associated to Book class 
	# is tablebooks and not book
	
	class Book < Media
	  acts_as_citier :table_name=>'tablebooks'
	end
	
	################################################
	
	class Dictionary < Book
	  acts_as_citier
	end
	
	################################################
	
	class Novel < Book
	  acts_as_citier
	end
	
	################################################
	
	class PocketDictionary < Dictionary
	end
	
	################################################
	
	class Unknown < Media
	end
	
	################################################
	
	class Video < Media
	  acts_as_citier
	end
	{% endhighlight %}

7. Install our gem
	{% highlight bash %}
$ gem install citier
{% endhighlight %}
or add it to your Gemfile

Final Notes
-----------
Whenever you modify a table (adding removing columns) please consider (if necessary) to update the (eventually) corresponding view. This can be done by successively Dropping and re-Creating the view (thanks to the DropTheViewForCITIEs and CreateTheViewForCITIEs methods)

We encourage you to try, test, use, enhance and document this gem. If you do, please give us some feed back at: citierforrails[at]gmail.com